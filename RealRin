local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")
local ContentProvider = game:GetService("ContentProvider")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Loading Screen UI
local loadingGui = Instance.new("ScreenGui")
loadingGui.Name = "BloxFruitsLoading"
loadingGui.IgnoreGuiInset = true
loadingGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
loadingGui.ResetOnSpawn = false

local backgroundFrame = Instance.new("Frame")
backgroundFrame.Name = "Background"
backgroundFrame.Size = UDim2.new(0, 0, 0, 0)
backgroundFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
backgroundFrame.BorderSizePixel = 0
backgroundFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
backgroundFrame.AnchorPoint = Vector2.new(0.5, 0.5)

local backgroundPattern = Instance.new("ImageLabel")
backgroundPattern.Name = "Pattern"
backgroundPattern.Size = UDim2.new(1, 0, 1, 0)
backgroundPattern.BackgroundTransparency = 1
backgroundPattern.Image = "rbxassetid://6073763717"
backgroundPattern.ImageTransparency = 0.85
backgroundPattern.ImageColor3 = Color3.fromRGB(0, 120, 215)
backgroundPattern.ScaleType = Enum.ScaleType.Tile
backgroundPattern.TileSize = UDim2.new(0, 200, 0, 200)

local messageFrame = Instance.new("Frame")
messageFrame.Name = "MessageFrame"
messageFrame.Size = UDim2.new(0.8, 0, 0.6, 0)
messageFrame.BackgroundTransparency = 1
messageFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
messageFrame.AnchorPoint = Vector2.new(0.5, 0.5)

local logoImage = Instance.new("ImageLabel")
logoImage.Name = "Logo"
logoImage.Size = UDim2.new(0, 150, 0, 150)
logoImage.BackgroundTransparency = 1
logoImage.Position = UDim2.new(0.5, 0, 0.3, 0)
logoImage.AnchorPoint = Vector2.new(0.5, 0.5)
logoImage.Image = "rbxassetid://6034848748"
logoImage.ImageTransparency = 1

local messageText = Instance.new("TextLabel")
messageText.Name = "Message"
messageText.Size = UDim2.new(1, 0, 0.25, 0)
messageText.Position = UDim2.new(0, 0, 0.5, 0)
messageText.BackgroundTransparency = 1
messageText.Font = Enum.Font.GothamMedium
messageText.TextScaled = true
messageText.TextColor3 = Color3.fromRGB(255, 255, 255)
messageText.TextXAlignment = Enum.TextXAlignment.Left
messageText.TextYAlignment = Enum.TextYAlignment.Top
messageText.TextWrapped = true
messageText.Text = ""

local spinnerFrame = Instance.new("Frame")
spinnerFrame.Name = "Spinner"
spinnerFrame.Size = UDim2.new(0, 40, 0, 40)
spinnerFrame.BackgroundTransparency = 1
spinnerFrame.Position = UDim2.new(0.5, 0, 0.85, 0)
spinnerFrame.AnchorPoint = Vector2.new(0.5, 0.5)
spinnerFrame.Visible = false -- Initially hidden

local dots = {}
for i = 1, 4 do
    local dot = Instance.new("Frame")
    dot.Name = "Dot" .. i
    dot.Size = UDim2.new(0, 8, 0, 8)
    dot.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    dot.BorderSizePixel = 0
    dot.AnchorPoint = Vector2.new(0.5, 0.5)

    local angle = (i - 1) * math.pi / 2
    local radius = 15
    local xPos = math.cos(angle) * radius
    local yPos = math.sin(angle) * radius

    dot.Position = UDim2.new(0.5, xPos, 0.5, yPos)

    local cornerRadius = Instance.new("UICorner")
    cornerRadius.CornerRadius = UDim.new(1, 0)
    cornerRadius.Parent = dot

    dots[i] = dot
    dot.Parent = spinnerFrame
end

local mainUI = Instance.new("Frame")
mainUI.Name = "MainUI"
mainUI.Size = UDim2.new(0.8, 0, 0.7, 0)
mainUI.BackgroundColor3 = Color3.fromRGB(20, 24, 35)
mainUI.Position = UDim2.new(1.5, 0, 0.5, 0)
mainUI.AnchorPoint = Vector2.new(0.5, 0.5)
mainUI.BorderSizePixel = 0
mainUI.Visible = false

local mainUIStroke = Instance.new("UIStroke")
mainUIStroke.Color = Color3.fromRGB(65, 105, 225)
mainUIStroke.Thickness = 2
mainUIStroke.Transparency = 0.3
mainUIStroke.Parent = mainUI

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0.02, 0)
uiCorner.Parent = mainUI

local uiGradient = Instance.new("UIGradient")
uiGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 34, 45)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 24, 35))
})
uiGradient.Rotation = 45
uiGradient.Parent = mainUI

local accentBar = Instance.new("Frame")
accentBar.Name = "AccentBar"
accentBar.Size = UDim2.new(0.2, 0, 0.01, 0)
accentBar.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
accentBar.BorderSizePixel = 0
accentBar.Position = UDim2.new(0.5, 0, 0.08, 0)
accentBar.AnchorPoint = Vector2.new(0.5, 0.5)
accentBar.Parent = mainUI

local accentBarCorner = Instance.new("UICorner")
accentBarCorner.CornerRadius = UDim.new(1, 0)
accentBarCorner.Parent = accentBar

local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, 0, 0.13, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Position = UDim2.new(0, 0, 0.13, 0)
titleLabel.Font = Enum.Font.GothamBlack
titleLabel.Text = "BLOX FRUITS"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextScaled = true
titleLabel.Parent = mainUI

local titleShadow = titleLabel:Clone()
titleShadow.Name = "TitleShadow"
titleShadow.TextColor3 = Color3.fromRGB(0, 170, 255)
titleShadow.TextTransparency = 0.7
titleShadow.Position = UDim2.new(0, 2, 0.13, 2)
titleShadow.ZIndex = titleLabel.ZIndex - 1
titleShadow.Parent = mainUI

local subtitleLabel = Instance.new("TextLabel")
subtitleLabel.Name = "Subtitle"
subtitleLabel.Size = UDim2.new(0.8, 0, 0.07, 0)
subtitleLabel.BackgroundTransparency = 1
subtitleLabel.Position = UDim2.new(0.5, 0, 0.25, 0)
subtitleLabel.AnchorPoint = Vector2.new(0.5, 0)
subtitleLabel.Font = Enum.Font.GothamSemibold
subtitleLabel.Text = "Final Stage of Loading"
subtitleLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
subtitleLabel.TextScaled = true
subtitleLabel.Parent = mainUI

local decorativeLine1 = Instance.new("Frame")
decorativeLine1.Name = "DecoLine1"
decorativeLine1.Size = UDim2.new(0.2, 0, 0.003, 0)
decorativeLine1.BackgroundColor3 = Color3.fromRGB(65, 105, 225)
decorativeLine1.Position = UDim2.new(0.2, 0, 0.35, 0)
decorativeLine1.BorderSizePixel = 0
decorativeLine1.Parent = mainUI

local decorativeLine2 = Instance.new("Frame")
decorativeLine2.Name = "DecoLine2"
decorativeLine2.Size = UDim2.new(0.2, 0, 0.003, 0)
decorativeLine2.BackgroundColor3 = Color3.fromRGB(65, 105, 225)
decorativeLine2.Position = UDim2.new(0.8, 0, 0.35, 0)
decorativeLine2.AnchorPoint = Vector2.new(1, 0)
decorativeLine2.BorderSizePixel = 0
decorativeLine2.Parent = mainUI

local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "Status"
statusLabel.Size = UDim2.new(0.8, 0, 0.06, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.Position = UDim2.new(0.5, 0, 0.4, 0)
statusLabel.AnchorPoint = Vector2.new(0.5, 0)
statusLabel.Font = Enum.Font.GothamMedium
statusLabel.Text = "Status: Initializing..."
statusLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
statusLabel.TextScaled = true
statusLabel.Parent = mainUI

local percentLabel = Instance.new("TextLabel")
percentLabel.Name = "Percent"
percentLabel.Size = UDim2.new(0.2, 0, 0.06, 0)
percentLabel.BackgroundTransparency = 1
percentLabel.Position = UDim2.new(0.9, 0, 0.55, 0)
percentLabel.AnchorPoint = Vector2.new(1, 0.5)
percentLabel.Font = Enum.Font.GothamBold
percentLabel.Text = "0%"
percentLabel.TextColor3 = Color3.fromRGB(0, 170, 255)
percentLabel.TextScaled = true
percentLabel.Parent = mainUI

local progressBarBackground = Instance.new("Frame")
progressBarBackground.Name = "ProgressBarBg"
progressBarBackground.Size = UDim2.new(0.8, 0, 0.06, 0)
progressBarBackground.Position = UDim2.new(0.5, 0, 0.55, 0)
progressBarBackground.AnchorPoint = Vector2.new(0.5, 0.5)
progressBarBackground.BackgroundColor3 = Color3.fromRGB(40, 44, 55)
progressBarBackground.BorderSizePixel = 0
progressBarBackground.Parent = mainUI

local progressBarStroke = Instance.new("UIStroke")
progressBarStroke.Color = Color3.fromRGB(65, 105, 225)
progressBarStroke.Thickness = 1
progressBarStroke.Transparency = 0.7
progressBarStroke.Parent = progressBarBackground

local progressBarCorner = Instance.new("UICorner")
progressBarCorner.CornerRadius = UDim.new(0.5, 0)
progressBarCorner.Parent = progressBarBackground

local progressBar = Instance.new("Frame")
progressBar.Name = "ProgressBar"
progressBar.Size = UDim2.new(0, 0, 1, 0)
progressBar.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
progressBar.BorderSizePixel = 0
progressBar.Parent = progressBarBackground

local progressBarCorner2 = Instance.new("UICorner")
progressBarCorner2.CornerRadius = UDim.new(0.5, 0)
progressBarCorner2.Parent = progressBar

local progressGradient = Instance.new("UIGradient")
progressGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 170, 255)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(65, 105, 225)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 170, 255))
})
progressGradient.Offset = Vector2.new(0, 0)
progressGradient.Parent = progressBar

local infoPanel = Instance.new("Frame")
infoPanel.Name = "InfoPanel"
infoPanel.Size = UDim2.new(0.8, 0, 0.25, 0)
infoPanel.Position = UDim2.new(0.5, 0, 0.7, 0)
infoPanel.AnchorPoint = Vector2.new(0.5, 0)
infoPanel.BackgroundColor3 = Color3.fromRGB(30, 34, 45)
infoPanel.BackgroundTransparency = 0.5
infoPanel.BorderSizePixel = 0
infoPanel.Parent = mainUI

local infoPanelCorner = Instance.new("UICorner")
infoPanelCorner.CornerRadius = UDim.new(0.05, 0)
infoPanelCorner.Parent = infoPanel

local infoPanelStroke = Instance.new("UIStroke")
infoPanelStroke.Color = Color3.fromRGB(65, 105, 225)
infoPanelStroke.Thickness = 1
infoPanelStroke.Transparency = 0.7
infoPanelStroke.Parent = infoPanel

local infoTitle = Instance.new("TextLabel")
infoTitle.Name = "InfoTitle"
infoTitle.Size = UDim2.new(1, 0, 0.2, 0)
infoTitle.BackgroundTransparency = 1
infoTitle.Font = Enum.Font.GothamSemibold
infoTitle.Text = "LOADING DETAILS"
infoTitle.TextColor3 = Color3.fromRGB(0, 170, 255)
infoTitle.TextScaled = true
infoTitle.Parent = infoPanel

local infoContent = Instance.new("TextLabel")
infoContent.Name = "InfoContent"
infoContent.Size = UDim2.new(0.95, 0, 0.7, 0)
infoContent.Position = UDim2.new(0.5, 0, 0.25, 0)
infoContent.AnchorPoint = Vector2.new(0.5, 0)
infoContent.BackgroundTransparency = 1
infoContent.Font = Enum.Font.Gotham
infoContent.Text = "Initializing game components..."
infoContent.TextColor3 = Color3.fromRGB(200, 200, 200)
infoContent.TextScaled = true
infoContent.TextWrapped = true
infoContent.TextXAlignment = Enum.TextXAlignment.Left
infoContent.TextYAlignment = Enum.TextYAlignment.Top
infoContent.Parent = infoPanel

-- Cached Tween Objects (for potential reuse)
local progressBarTween
local mainUITween

local function animateSpinner()
    local spinSpeed = 2
    local dotOpacity = {1, 0.7, 0.4, 0.1}

    return RunService.Heartbeat:Connect(function()
        if spinnerFrame.Visible then
            for i = 1, 4 do
                local dot = dots[i]
                if dot then
                    local currentIndex = (i + math.floor(tick() * spinSpeed)) % 4 + 1
                    dot.BackgroundTransparency = 1 - dotOpacity[currentIndex]
                end
            end
        end
    end)
end

local function animateProgressGradient()
    return RunService.Heartbeat:Connect(function()
        if progressGradient and mainUI.Visible then
