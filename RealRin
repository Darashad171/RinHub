-- Services
local TS = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")

-- Gui Elements
local gui = script.Parent
local main = gui.Main
local topbar = main.Topbar
local exitBtn = topbar.Exit
local minimizeBtn = topbar.Minimize
local contentFrame = main.Content
local bg = main.Background

-- Variables
local minimized = false
local originalSize = main.Size
local originalPosition = main.Position

-- Confirmation Frame
local confirmFrame = Instance.new("Frame")
confirmFrame.Size = UDim2.new(0, 180, 0, 100)
confirmFrame.Position = UDim2.new(0.5, 0, 0, 10) -- nasa itaas ng UI
confirmFrame.AnchorPoint = Vector2.new(0.5, 0)
confirmFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
confirmFrame.BorderSizePixel = 0
confirmFrame.Visible = false
confirmFrame.ZIndex = 10
confirmFrame.Parent = main

local confirmCorner = Instance.new("UICorner")
confirmCorner.CornerRadius = UDim.new(0, 8)
confirmCorner.Parent = confirmFrame

local confirmText = Instance.new("TextLabel")
confirmText.Size = UDim2.new(1, -20, 0, 50)
confirmText.Position = UDim2.new(0, 10, 0, 5)
confirmText.BackgroundTransparency = 1
confirmText.Text = "Are you sure you want to exit?"
confirmText.TextColor3 = Color3.fromRGB(0, 0, 0)
confirmText.TextSize = 14
confirmText.Font = Enum.Font.Gotham
confirmText.TextWrapped = true
confirmText.Parent = confirmFrame

local yesBtn = Instance.new("TextButton")
yesBtn.Size = UDim2.new(0.4, 0, 0, 25)
yesBtn.Position = UDim2.new(0.1, 0, 1, -35)
yesBtn.BackgroundColor3 = Color3.fromRGB(0, 255, 127)
yesBtn.Text = "Yes"
yesBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
yesBtn.Font = Enum.Font.GothamBold
yesBtn.TextSize = 14
yesBtn.Parent = confirmFrame

local yesCorner = Instance.new("UICorner")
yesCorner.CornerRadius = UDim.new(0, 6)
yesCorner.Parent = yesBtn

local noBtn = Instance.new("TextButton")
noBtn.Size = UDim2.new(0.4, 0, 0, 25)
noBtn.Position = UDim2.new(0.5, 10, 1, -35)
noBtn.BackgroundColor3 = Color3.fromRGB(255, 85, 85)
noBtn.Text = "No"
noBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
noBtn.Font = Enum.Font.GothamBold
noBtn.TextSize = 14
noBtn.Parent = confirmFrame

local noCorner = Instance.new("UICorner")
noCorner.CornerRadius = UDim.new(0, 6)
noCorner.Parent = noBtn

-- Dragging
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

topbar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = main.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

topbar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UIS.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Exit Button Functionality
exitBtn.MouseButton1Click:Connect(function()
    confirmFrame.Visible = true
end)

yesBtn.MouseButton1Click:Connect(function()
    TS:Create(main, TweenInfo.new(0.2), {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0)
    }):Play()
    task.wait(0.2)
    gui:Destroy()
end)

noBtn.MouseButton1Click:Connect(function()
    confirmFrame.Visible = false
end)

-- Minimize Button Functionality
minimizeBtn.MouseButton1Click:Connect(function()
    if minimized then
        minimized = false
        TS:Create(main, TweenInfo.new(0.3), {
            Size = originalSize
        }):Play()
        contentFrame.Visible = true
        bg.Visible = true
    else
        minimized = true
        TS:Create(main, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 200, 0, 50)
        }):Play()
        contentFrame.Visible = false
        bg.Visible = false
    end
end)
